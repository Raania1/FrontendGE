<div class="container mx-auto p-6 max-w-7xl">
    <h2 class="text-2xl font-bold mb-6">Gestion des Messages</h2>
    <p class="text-gray-600 mb-6">Consultez et répondez aux messages reçus</p>

    <div class="flex flex-col md:flex-row gap-4 mb-6">
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        placeholder="Rechercher un message..." 
        class="flex-grow p-2 border border-gray-300 rounded"
      >
      
      <div class="flex gap-2">
        <button 
          (click)="setFilter('TOUS')"
          [class.bg-custom-orangeBold]="currentFilter === 'TOUS'"
          [class.text-white]="currentFilter === 'TOUS'"
          class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-100"
        >
          Tous
        </button>
        <button 
          (click)="setFilter('PRIVATE')"
          [class.bg-custom-orangeBold]="currentFilter === 'PRIVATE'"
          [class.text-white]="currentFilter === 'PRIVATE'"
          class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-100 flex items-center gap-2"
        >
          Privé
          <span class="bg-white text-custom-orangeBold rounded-full px-2 py-1 text-xs">
            {{pendingCount}}
          </span>
        </button>
        <button 
          (click)="setFilter('PUBLIC')"
          [class.bg-custom-orangeBold]="currentFilter === 'PUBLIC'"
          [class.text-white]="currentFilter === 'PUBLIC'"
          class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-100 flex items-center gap-2"
        >
          Public
          <span class="bg-white text-custom-orangeBold rounded-full px-2 py-1 text-xs">
            {{publicCount}}
          </span>
        </button>
      </div>
    </div>
  
    <div class="flex flex-col lg:flex-row gap-6">
      <div class="w-full lg:w-1/3 bg-white rounded-lg shadow overflow-hidden">
        <div class="p-4 border-b bg-gray-50">
          <h3 class="font-medium">Liste des messages</h3>
        </div>
        
        <div *ngIf="filteredMessages.length === 0" class="p-8 text-center text-gray-500">
          Aucun message trouvé
        </div>
  
        <div class="divide-y">
          <div 
            *ngFor="let msg of filteredMessages" 
            (click)="selectMessage(msg)"
            [class.bg-purple-50]="selectedMessage?.id === msg.id"
            class="p-4 cursor-pointer hover:bg-gray-50 transition-colors"
          >
            <div class="flex justify-between items-start">
              <div>
                <h4 class="font-semibold">{{msg.NomComplet}}</h4>
                <p class="text-sm text-gray-600">{{msg.email}}</p>
              </div>
              <span 
                [class.bg-yellow-100]="msg.Status === 'PRIVATE'"
                [class.text-yellow-800]="msg.Status === 'PRIVATE'"
                [class.bg-green-100]="msg.Status === 'PUBLIC'"
                [class.text-green-800]="msg.Status === 'PUBLIC'"
                class="text-xs px-2 py-1 rounded-full"
              >
                {{msg.Status === 'PRIVATE' ? 'Privé' : 'Public'}}
              </span>
            </div>
            
            <h5 class="font-medium mt-2">{{msg.Sujet}}</h5>
            <p class="text-sm text-gray-600 mt-1 line-clamp-2">{{msg.Message}}</p>
            <p class="text-xs text-gray-500 mt-2">{{msg.createdAt | date:'dd MMMM yyyy' }}</p>
          </div>
        </div>
      </div>
  
      <div class="w-full lg:w-2/3">
        <div *ngIf="!selectedMessage" class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
          <p>Sélectionnez un message pour voir les détails</p>
        </div>
  
        <div *ngIf="selectedMessage && !replyMode" class="bg-white rounded-lg shadow overflow-hidden">
          <div class="p-4 border-b bg-gray-50 flex justify-between items-center">
            <h3 class="font-semibold">{{selectedMessage.Sujet}}</h3>
            <div class="flex gap-2">
              <button 
                (click)="markAsPublic()"
                *ngIf="selectedMessage.Status === 'PRIVATE'"
                class="text-sm px-3 py-1 bg-gray-100 rounded hover:bg-gray-200"
              >
                Marquer comme public
              </button>
              <button 
                (click)="deleteMessage()"
                class="text-sm px-3 py-1 bg-red-100 rounded hover:bg-red-200"
              >
                Supprimer
              </button>
            </div>
          </div>
  
          <div class="p-6">
            <div class="mb-4">
              <p class="text-sm text-gray-600 mb-1">De : {{selectedMessage.NomComplet}} &lt;{{selectedMessage.email}}&gt;</p>
              <p class="text-sm text-gray-500">Date : {{ selectedMessage.createdAt | date:'dd MMMM yyyy' }}</p>
            </div>
  
            <div class="prose max-w-none mb-6">
              <p class="whitespace-pre-line">{{selectedMessage.Message}}</p>
            </div>
  
            <button 
              (click)="showReplyForm()"
              class="px-4 py-2 bg-custom-orangeBold text-white rounded hover:bg-custom-orangethrow"
            >
              Répondre
            </button>
          </div>
        </div>
  
        <div *ngIf="replyMode" class="bg-white rounded-lg shadow overflow-hidden">
          <div class="p-4 border-b bg-gray-50">
            <h3 class="font-semibold">Répondre à {{selectedMessage?.NomComplet}}</h3>
          </div>
  
          <div class="p-6 space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">À :</label>
              <p class="text-gray-600">{{selectedMessage?.email}}</p>
            </div>
  
            <div>
              <label for="replySubject" class="block text-sm font-medium text-gray-700 mb-1">Sujet :</label>
              <input
                id="replySubject"
                type="text"
                [(ngModel)]="replySubject"
                class="w-full p-2 border border-gray-300 rounded focus:ring-custom-orangeBold focus:border-custom-orangethrow"
              >
            </div>
  
            <div>
              <label for="replyContent" class="block text-sm font-medium text-gray-700 mb-1">Message :</label>
              <textarea
                id="replyContent"
                [(ngModel)]="replyContent"
                rows="8"
                class="w-full p-2 border border-gray-300 rounded focus:ring-custom-orangeBold focus:border-custom-orangethrow"
                placeholder="Écrivez votre réponse ici..."
              ></textarea>
            </div>
  
            <div class="flex justify-end gap-3 pt-2">
              <button
                (click)="cancelReply()"
                class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
              >
                Annuler
              </button>
              <button
                (click)="sendReply()"
                class="px-4 py-2 bg-custom-orangeBold text-white rounded-md hover:bg-custom-orangethrow"
              >
                Envoyer la réponse
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>